# Scenarios - Sign-in users to a Web App. Web App calling Web APIs on behalf of the signed-in user

## Scenario

### Overview

You add authentication to your Web App, which can therefore sign in users and calls a web API on behalf of the signed-in user.

![Daemon apps](./media/scenarios/web-apps.svg)

Web Apps calling Web APIs:

- are confidential client applications.
- therefore they have registered a secret (application password or certificate) with Azure AD. This secret is passed-in during the call to Azure AD to get a token

### Specifics

> [!NOTE]
> - Adding sign-in to a Web App does not use the MSAL libraries as this is about protecting the Web App. Protecting libraries is achieved by libraries named Middleware. This was the object of the previous scenario [Sign-in users to a Web App](scenario-webapp-signs-in-users.md)
>
> - Calling Web APIs from a Web App can be done by the MSAL libraries.

The end to end experience of developers for this scenario has, therefore, specific aspects as:

- During the [Application registration](#app-registration-specifics), you'll need to provide one, or several (if you deploy your app to several locations) Reply URIs, secrets, or certificates need to be shared with Azure AD.
- The [Application configuration](#msal-libraries-applications-code-configuration) needs to provide client credentials as shared with Azure AD during the application registration

## Libraries supporting Web App scenarios

The libraries supporting the authorization code flow for Web Apps are:

  MSAL library | Description
  ------------ | ----------
![MSAL.NET](media/sample-v2-code/logo_NET.png) <br/> MSAL.NET  | Supported platforms are .NET Framework and .NET Core platforms (not UWP, Xamarin.iOS, and Xamarin.Android as those platforms are used to build public client applications)
![Python](media/sample-v2-code/logo_python.png) <br/> MSAL.Python | development in progress - public preview to come
![Java](media/sample-v2-code/logo_java.png) <br/> MSAL.Java | development in progress

## App registration specifics

### Registration of secrets or certificates

Like for any confidential client application, you need to register a secret or certificate. You can register your application secrets either through the interactive experience in the [Azure portal](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview), or using command-line tools (like PowerShell)

#### Registering client secrets using the application registration portal

The management of client credentials happens in the **certificates & secrets** page for an application:

![image](media/quickstart-update-azure-ad-app-preview/credentials-certificates-secrets-expanded.png)

- the application secret (also named client secret) is generated by Azure AD, during the registration of the confidential client application, when you select **New client secret**. At that point, you must copy the secret string in the clipboard for use in your app, before selecting **Save**. This string won't be presented any longer.
- the certificate is uploaded in the application registration using the **Upload certificate** button

For details, see [Quickstart: Configure a client application to access web APIs | Add credentials to your application](quickstart-configure-app-access-web-apis.md#add-credentials-to-your-web-application)

#### Registering client secrets using PowerShell

Alternatively, you can register your application with Azure AD using command-line tools. The [active-directory-dotnetcore-daemon-v2](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2) sample shows how to register an application secret or a certificate with an Azure AD application:

- For details on how to register an application secret, see [AppCreationScripts/Configure.ps1](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/5199032b352a912e7cc0fce143f81664ba1a8c26/AppCreationScripts/Configure.ps1#L190)
- For details on how to register a certificate with the application, see [AppCreationScripts-withCert/Configure.ps1](https://github.com/Azure-Samples/active-directory-dotnetcore-daemon-v2/blob/5199032b352a912e7cc0fce143f81664ba1a8c26/AppCreationScripts-withCert/Configure.ps1#L162-L178)

## MSAL libraries: Application's code configuration

### Application configuration and instantiation

In MSAL libraries, the Client Credentials (secret or certificate) are passed as a parameter of the ``ConfidentialClientApplication`` construction.

# [.NET](#tab/dotnet)

```CSharp
using Microsoft.Identity.Client.ApiConfig;

IConfidentialClientApplication app;
```

Here is the code to build an application with an application secret:

```CSharp
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
           .WithClientSecret(config.ClientSecret)
           .WithAuthority(new Uri(config.Authority))
           .Build();
```

Here is the code to build an application with a certificate:

```CSharp
X509Certificate2 certificate = ReadCertificate(config.CertificateName);
app = ConfidentialClientApplicationBuilder.Create(config.ClientId)
    .WithCertificate(certificate)
    .WithAuthority(new Uri(config.Authority))
    .Build();
```

# [Python](#tab/python)

```Python
# Create a preferably long-lived app instance which maintains a token cache.

app = msal.ConfidentialClientApplication(
    config["client_id"], authority=config["authority"],
    client_credential=config["secret"],
    # token_cache=...  # Default cache is in memory only.
                       # You can learn how to use SerializableTokenCache from
                       # https://msal-python.rtfd.io/en/latest/#msal.SerializableTokenCache

    )
```

___

## MSAL libraries: Token acquisition

